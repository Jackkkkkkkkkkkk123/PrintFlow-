{% load static %}
{% load rbac_menu %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>华龙印务管理系统</title>
    <link rel="shortcut icon" href="{% static 'imgs/luffy-study-logo.png' %} ">
    <link rel="stylesheet" href="{% static 'plugins/bootstrap/css/bootstrap.css' %} "/>
    <link rel="stylesheet" href="{% static 'plugins/font-awesome/css/font-awesome.css' %} "/>
    <link rel="stylesheet" href="{% static 'css/commons.css' %} "/>
    <link rel="stylesheet" href="{% static 'css/nav.css' %} "/>
    <link rel="stylesheet" href="{% static 'rbac/rbac.css' %} "/>
    <link rel="stylesheet" href="{% static 'css/bootstrap-datetimepicker.min.css' %} "/>
    
    <!-- 在head中提前加载jQuery -->
    <script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    
    <style>
        body {
            margin: 0;
        }

        .no-radius {
            border-radius: 0;
        }

        .no-margin {
            margin: 0;
        }

        .pg-body > .left-menu {
            background-color: #EAEDF1;
            position: absolute;
            left: 1px;
            top: 48px;
            bottom: 0;
            width: 220px;
            border: 1px solid #EAEDF1;
            overflow: auto;
        }

        .pg-body > .right-body {
            position: absolute;
            left: 225px;
            right: 0;
            top: 48px;
            bottom: 0;
            overflow: scroll;
            border: 1px solid #ddd;
            border-top: 0;
            font-size: 13px;
            min-width: 755px;
        }

        .navbar-right {
            float: right !important;
            margin-right: -15px;
        }
        .rbac_container {
            padding: 20px 10px;
        }
        
        /* 文件上传区域样式 */
        .upload-container {
            max-width: 600px;
            margin: 20px auto;
            padding: 20px;
            background-color: #fff;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        .upload-progress {
            margin-top: 15px;
            display: none;
        }
        .alert-container {
            position: fixed;
            top: 70px;
            right: 20px;
            width: 300px;
            z-index: 9999;
        }
        
        /* 自定义菜单样式 */
        .multi-menu .item {
            border-bottom: 1px solid #ddd;
        }
        
        .multi-menu .item .title {
            padding: 12px 15px;
            background-color: #f8f9fa;
            border-bottom: 1px solid #ddd;
            cursor: pointer;
            font-weight: 500;
            color: #333;
            user-select: none;
        }
        
        .multi-menu .item .title:hover {
            background-color: #e9ecef;
        }
        
        .multi-menu .item .title a {
            color: inherit !important;
            text-decoration: none !important;
        }
        
        .icon-wrap {
            margin-right: 8px;
            width: 20px;
            display: inline-block;
        }
    </style>
    {% block css %}
    {% endblock %}
</head>
<body>

<div class="pg-header">
    <div class="nav">
        <div class="logo-area left">
            <a href="#">
                <span style="font-size: 18px;">华龙印务</span>
            </a>
        </div>

        <div class="left-menu left">
            <a class="menu-item"></a>
            <a class="menu-item"></a>
            <a class="menu-item"></a>
        </div>

        <div class="right-menu right clearfix">

            <div class="user-info right">
                <a href="#" class="avatar">
                        
                </a>

                <div class="more-info">
                    <a href="#" class="more-item">个人信息</a>
                    <a href="{% url 'logout' %}" class="more-item">注销</a>
                </div>
            </div>
            <a class="user-menu right">
                消息
                <i class="fa fa-commenting-o" aria-hidden="true"></i>
                <span class="badge bg-success">2</span>
            </a>

            <a class="user-menu right">
                通知
                <i class="fa fa-envelope-o" aria-hidden="true"></i>
                <span class="badge bg-success">2</span>
            </a>

            <a class="user-menu right">
                任务
                <i class="fa fa-bell-o" aria-hidden="true"></i>
                <span class="badge bg-danger">4</span>
            </a>
        </div>

    </div>
</div>
<div class="pg-body">
    <div class="left-menu">
        <div class="menu-body">
            <div class="multi-menu">
                <!-- 首页 -->
                <div class="item">
                    <div class="title">
                        <span class="icon-wrap"><i class="fa fa-home"></i></span> 
                        <a href="{% url 'index' %}" style="color: inherit; text-decoration: none;">首页</a>
                    </div>
                </div>
                
                <!-- 仪表盘 -->
                <div class="item">
                    <div class="title">
                        <span class="icon-wrap"><i class="fa fa-dashboard"></i></span> 
                        <a href="{% url 'print_dashboard' %}" style="color: inherit; text-decoration: none;">仪表盘</a>
                    </div>
                </div>
                
                <!-- 用户列表 -->
                <div class="item">
                    <div class="title">
                        <span class="icon-wrap"><i class="fa fa-users"></i></span> 
                        <a href="/stark/crm/userinfo/list/" style="color: inherit; text-decoration: none;">用户列表</a>
                    </div>
                </div>
                
                <!-- 添加用户 -->
                <div class="item">
                    <div class="title">
                        <span class="icon-wrap"><i class="fa fa-user-plus"></i></span> 
                        <a href="/stark/crm/userinfo/add/" style="color: inherit; text-decoration: none;">添加用户</a>
                    </div>
                </div>
                
                <!-- 订单列表 -->
                <div class="item">
                    <div class="title">
                        <span class="icon-wrap"><i class="fa fa-list-alt"></i></span> 
                        <a href="{% url 'print_order_list' %}" style="color: inherit; text-decoration: none;">订单列表</a>
                    </div>
                </div>
                
                <!-- 添加订单 -->
                <div class="item">
                    <div class="title">
                        <span class="icon-wrap"><i class="fa fa-plus-circle"></i></span> 
                        <a href="{% url 'create_print_order' %}" style="color: inherit; text-decoration: none;">添加订单</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="right-body">
        <div style="padding: 10px 0 0 10px;">
            <button id="toggle-fullscreen" class="btn btn-default btn-xs" style="margin-bottom: 10px;">
                <i class="fa fa-arrows-alt"></i> 全屏/收起导航
            </button>
        </div>
        <div>
            <ol class="breadcrumb no-radius no-margin" style="border-bottom: 1px solid #ddd;">
                {% breadcrumb request %}
            </ol>
        </div>
        
        
        
        {% block content %} {% endblock %}
    </div>
</div>

<!-- 通知容器 -->
<div class="alert-container"></div>
<div id="notification-container" class="alert-container"></div>

<!-- 移除重复的jQuery引用 -->
<script src="{% static 'rbac/rbac.js' %}"></script>
<script src="{% static 'plugins/bootstrap/js/bootstrap.js' %} "></script>
<script src="{% static 'js/bootstrap-datetimepicker.js' %}"></script>
<script src="{% static 'js/bootstrap-datetimepicker.fr.js' %}"></script>
<script src="{% static 'js/bootstrap-datetimepicker.zh-CN.js' %}"></script>
<script src="{% static 'js/jquery.cookie.js' %}"></script>

<!-- WebSocket客户端 -->
<script src="{% static 'js/websocket-client.js' %}"></script>

<script>
$(document).ready(function(){
    console.log('jQuery version:', window.jQuery && $.fn.jquery);
    $('#toggle-fullscreen').on('click', function(){
        $('.right-body').toggleClass('fullscreen-mode');
        console.log('按钮被点击，class切换：', $('.right-body').hasClass('fullscreen-mode'));
    });
    
    // 初始化WebSocket客户端
    if (typeof WebSocketClient !== 'undefined') {
        window.wsClient = new WebSocketClient();
        console.log('WebSocket客户端已初始化');
    } else {
        console.error('WebSocket客户端类未找到');
    }
});
</script>

<style>
.right-body {
    transition: transform 0.4s cubic-bezier(.4,0,.2,1), box-shadow 0.3s, background 0.3s;
    /* 保持原有布局 */
}
.right-body.fullscreen-mode {
    transform: translateX(-225px); /* 225px为左侧导航宽度 */
    width: 100vw !important;
    z-index: 9999 !important;
    background: #fff !important;
    min-width: 0 !important;
    box-shadow: 0 0 10px rgba(0,0,0,0.08);
}
</style>

{% block js %} {% endblock %}
</body>
</html>