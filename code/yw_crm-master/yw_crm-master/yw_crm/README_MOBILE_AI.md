# 印刷订单管理系统 - 手机端 & AI助手

## 🔄 更新内容

本次更新为印刷订单管理系统添加了以下重要功能：

### ✅ 已实现功能

1. **📱 手机端响应式页面**
   - 自动设备检测（PC/手机）
   - 用户权限分级（普通用户/root用户）
   - 实时WebSocket数据更新
   - 现代化移动端UI设计

2. **🤖 AI智能助手**
   - 每日工作报告自动生成
   - 异常数据智能分析
   - 交期风险提前预警
   - 每天下午5:30自动发送日报

3. **⏰ 定时任务系统**
   - 自动化报告生成
   - 灵活的调度配置
   - 详细的日志记录

---

## 📱 手机端功能

### 设备自动检测

系统会自动检测用户的设备类型：

- **PC用户**：显示完整的桌面版界面
- **手机用户**：自动跳转到手机端优化界面

### 用户权限分级

#### 普通用户手机端功能：
- 📋 订单列表查看
- 📊 基础统计信息
- 🔄 实时状态更新
- 📱 触摸友好的操作界面

#### Root用户手机端功能：
- 📋 订单列表查看
- 📊 完整仪表板
- 🤖 AI智能助手
- 🚨 紧急订单提醒
- ⚡ 高级管理功能

### 手机端访问地址

```
# 普通用户首页（自动跳转）
http://your-domain/mobile/orders/

# Root用户仪表板（自动跳转）
http://your-domain/mobile/dashboard/

# AI助手（仅限root用户）
http://your-domain/mobile/ai-assistant/
```

### 手机端特性

1. **响应式设计**
   - 适配各种屏幕尺寸
   - 支持横竖屏切换
   - 优化触摸操作

2. **实时更新**
   - WebSocket自动连接
   - 订单状态实时同步
   - 进度变化即时通知

3. **离线友好**
   - 网络断开自动重连
   - 数据缓存机制
   - 友好的错误提示

---

## 🤖 AI智能助手

### 核心功能

#### 1. 📊 每日工作报告
- **生成时间**：每天下午5:30自动生成
- **报告内容**：
  - 当日新增订单统计
  - 完成/开始步骤汇总
  - 工作效率分析
  - 待处理订单提醒

#### 2. 🔍 异常数据分析
- **长期未处理订单**：超过3天未开始处理的订单
- **停滞的生产步骤**：超过2天未完成的步骤
- **紧急交期订单**：2天内需要交付的订单

#### 3. ⏰ 交期风险预警
- **已逾期订单**：超过交期仍未完成
- **今日交期**：当天需要交付的订单
- **明日交期**：明天需要交付的订单
- **本周交期**：本周内需要完成的订单

### 使用方式

#### 手机端使用
1. 使用root账户登录
2. 访问手机端页面（自动跳转）
3. 点击底部导航的"🤖 AI助手"
4. 选择所需功能：
   - 📊 生成日报
   - 🔍 异常分析
   - ⏰ 交期检查

#### API接口调用
```bash
# 生成日报
POST /api/ai/daily-report/

# 异常分析
POST /api/ai/analyze-anomalies/

# 交期检查
POST /api/ai/check-deadlines/
```

---

## ⏰ 定时任务系统

### 自动日报生成

系统每天下午5:30自动生成工作日报，包含：

- 📈 当日数据统计
- ✅ 完成步骤详情
- ⚡ 工作效率分析
- 🚨 异常情况提醒

### 手动管理命令

```bash
# 立即生成日报（忽略时间限制）
python manage.py generate_daily_report --force

# 自动模式（仅在指定时间生成）
python manage.py generate_daily_report --auto
```

### 定时任务调度器

#### 启动调度器
```bash
# 测试功能
python start_ai_scheduler.py --test

# 运行一次日报生成
python start_ai_scheduler.py --once

# 后台运行定时任务
python start_ai_scheduler.py --daemon

# 交互模式
python start_ai_scheduler.py
```

#### 系统集成（Windows）
可以使用Windows任务计划程序来设置开机自启：

1. 打开"任务计划程序"
2. 创建基本任务
3. 设置触发器为"计算机启动时"
4. 操作设置为：
   ```
   程序: python
   参数: start_ai_scheduler.py --daemon
   起始位置: E:\Aprint\code\yw_crm-master\yw_crm-master\yw_crm\
   ```

---

## 🚀 部署和启动

### 1. 安装依赖
```bash
# 安装新增依赖
pip install schedule==1.2.0

# 或重新安装所有依赖
pip install -r requirements.txt
```

### 2. 启动WebSocket服务器
```bash
python run_websocket_server.py
```

### 3. 启动AI定时任务（可选）
```bash
# 后台运行
python start_ai_scheduler.py --daemon

# 或在新的终端窗口运行
python start_ai_scheduler.py
```

### 4. 访问测试

#### PC端测试
```
http://127.0.0.1:5173/index/
```

#### 手机端测试
1. 使用手机浏览器或模拟器访问
2. 或在PC浏览器开发者工具中模拟移动设备
3. 访问：`http://127.0.0.1:5173/index/`（自动跳转到手机端）

---

## 📋 功能清单

### ✅ 已完成
- [x] 设备类型自动检测
- [x] 手机端响应式UI设计
- [x] 用户权限分级显示
- [x] 手机端订单列表页面
- [x] 手机端仪表板页面
- [x] AI助手界面和功能
- [x] 日报自动生成
- [x] 异常数据分析
- [x] 交期风险预警
- [x] 定时任务调度系统
- [x] WebSocket实时更新
- [x] API接口完整实现

### 🔄 可扩展功能
- [ ] 邮件/短信通知
- [ ] 数据导出功能
- [ ] 更多AI分析维度
- [ ] 历史报告查看
- [ ] 自定义报告模板
- [ ] 移动端推送通知

---

## 🛠️ 技术架构

### 前端技术
- **响应式设计**：CSS Grid + Flexbox
- **移动端优化**：Touch-friendly UI
- **实时通信**：WebSocket
- **现代浏览器兼容**：ES6+

### 后端技术
- **Django 4.2.8**：Web框架
- **Channels 4.0.0**：WebSocket支持
- **Redis**：消息队列和缓存
- **Schedule**：定时任务调度

### AI助手
- **数据分析**：Django ORM查询
- **报告生成**：HTML模板渲染
- **异常检测**：规则引擎
- **定时执行**：Schedule库

---

## 📞 支持和维护

### 日志文件
- **WebSocket日志**：在启动终端查看
- **AI任务日志**：`ai_scheduler.log`
- **日报记录**：`daily_reports.log`

### 常见问题

1. **手机端无法访问**
   - 检查防火墙设置
   - 确保手机和PC在同一网络
   - 使用实际IP地址而非127.0.0.1

2. **AI助手权限不足**
   - 确保使用root账户登录
   - 检查用户权限配置

3. **定时任务不执行**
   - 检查调度器是否启动
   - 查看日志文件确认错误信息
   - 验证时间设置是否正确

### 技术支持
如有问题请查看日志文件或联系开发团队。

---

**🎉 享受全新的移动端管理体验和AI智能助手功能！** 